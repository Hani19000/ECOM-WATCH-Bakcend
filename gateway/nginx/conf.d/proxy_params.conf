# ================================================================
# Proxy params communs — inclus dans chaque location block
# ================================================================

# Passer les vraies infos client au monolithe
proxy_set_header Host               $host;
proxy_set_header X-Real-IP          $remote_addr;
proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto  $scheme;

# Traçabilité inter-services
proxy_set_header X-Request-ID       $request_id;

# Timeouts adaptés à Render (cold start possible)
proxy_connect_timeout   10s;
proxy_send_timeout      60s;
proxy_read_timeout      60s;

# Keep-alive vers l'upstream
proxy_http_version 1.1;
proxy_set_header Connection "";

# CORS — injectés sur toutes les réponses upstream
add_header Access-Control-Allow-Origin      $cors_origin always;
add_header Access-Control-Allow-Credentials "true"       always;
add_header X-Gateway                        "ecom-watch" always;